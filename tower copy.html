<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë…¼ìŸì˜ íƒ‘ [ì‹¬íŒ í…ŒìŠ¤íŠ¸] - ë‚´íƒ“ë„¤íƒ“</title>
    <style>
        body { margin: 0; background-color: #1a1a1a; font-family: 'Pretendard', sans-serif; color: #ffffff; }
        .mobile-container {
            width: 100%; max-width: 430px; min-height: 100vh; margin: 0 auto;
            display: flex; flex-direction: column; padding: 40px 20px; box-sizing: border-box;
            background: linear-gradient(180deg, #1a1a1a 0%, #2d3436 100%);
        }
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .back-btn { font-size: 28px; color: #fff; text-decoration: none; cursor: pointer; }
        .tower-status { text-align: center; margin-bottom: 10px; }
        .floor-num { font-size: 32px; font-weight: 900; color: #ffd700; text-shadow: 0 0 10px rgba(255,215,0,0.5); }
        
        .survival-badge { background: #00b894; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; color: white; display: inline-block; }
        .eliminated-badge { background: #d63031 !important; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; color: white; display: inline-block; }

        .debate-card {
            background: rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 30px 20px;
            text-align: center; border: 1px solid rgba(255,255,255,0.2); margin-bottom: 20px;
            min-height: 120px; display: flex; flex-direction: column; justify-content: center;
        }
        .timer { font-size: 16px; color: #ffd700; font-weight: bold; margin-bottom: 10px; }
        .question { font-size: 18px; font-weight: bold; line-height: 1.6; word-break: keep-all; }

        .result-box { margin-top: 15px; display: none; }
        .gauge-bar {
            height: 25px; width: 100%; background: #444; border-radius: 12px;
            overflow: hidden; display: flex; position: relative; border: 1px solid rgba(255,255,255,0.1);
        }
        .gauge-my { height: 100%; background: #0984e3; transition: width 0.5s ease-in-out; }
        .gauge-your { height: 100%; background: #e84393; transition: width 0.5s ease-in-out; }
        .gauge-text {
            position: absolute; width: 100%; display: flex; justify-content: space-between;
            padding: 0 10px; box-sizing: border-box; line-height: 25px; font-size: 12px; font-weight: bold;
        }

        .vote-group { display: flex; flex-direction: column; gap: 15px; width: 100%; }
        .vote-btn {
            padding: 20px; border-radius: 15px; border: none; font-size: 18px; font-weight: bold;
            cursor: pointer; transition: 0.3s; color: white;
        }
        .btn-my { background: #0984e3; border: 2px solid transparent; }
        .btn-your { background: #e84393; border: 2px solid transparent; }
        .vote-btn.selected { border-color: #ffffff; box-shadow: 0 0 15px rgba(255,255,255,0.5); }
        .vote-btn:disabled { background: #444; cursor: not-allowed; opacity: 0.5; }
        
        .revive-btn {
            background: #ffd700; color: #000; padding: 15px; border-radius: 15px;
            font-weight: bold; border: none; margin-top: 20px; cursor: pointer; width: 100%;
            z-index: 100; position: relative;
        }
        .reward-info {
            margin-top: auto; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 15px;
            font-size: 13px; text-align: center;
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <div class="header">
            <div class="back-btn" onclick="location.href='main.html'">&lt;</div>
            <div id="userCoinDisplay" style="color: #ffd700; font-weight: bold;">ğŸŸ¡ 0</div>
        </div>

        <div class="tower-status">
            <div id="currentFloor" class="floor-num">1ì¸µ</div>
            <span id="statusBadge" class="survival-badge">ìƒì¡´ ì¤‘</span>
        </div>

        <div class="debate-card">
            <div class="timer" id="roundTimer">ë‚¨ì€ ì‹œê°„ 15ì´ˆ</div>
            <div class="question" id="debateQuestion">ì§ˆë¬¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            
            <div id="resultBox" class="result-box">
                <div class="gauge-bar">
                    <div id="barMy" class="gauge-my"></div>
                    <div id="barYour" class="gauge-your"></div>
                    <div class="gauge-text">
                        <span id="textMy">ë‚´ íƒ“ 0%</span>
                        <span id="textYour">ë„¤ íƒ“ 0%</span>
                    </div>
                </div>
                <div id="winTag" style="color:#ffd700; font-size:12px; margin-top:8px; font-weight:bold;">íŒê²° ì¤‘...</div>
            </div>
        </div>

        <div class="vote-group" id="voteGroup">
            <button id="btnMy" class="vote-btn btn-my" onclick="castVote('my')">ë‚´ íƒ“ì´ë‹¤</button>
            <button id="btnYour" class="vote-btn btn-your" onclick="castVote('your')">ë„¤ íƒ“ì´ë‹¤</button>
        </div>

        <button id="reviveBtn" class="revive-btn" style="display: none;" onclick="revive()">
            ğŸŸ¡ 100 ì½”ì¸ìœ¼ë¡œ ë¶€í™œí•˜ê¸°
        </button>

        <div class="reward-info">
            í˜„ì¬ ì¸µ í†µê³¼ ë³´ìƒ: <span id="rewardCoin" style="color: #ffd700;">10ê°œ</span><br>
            <span style="font-size: 11px; color: #888;">ë‹¤ìˆ˜ê²°ì— ì†í•´ì•¼ ë‹¤ìŒ ì¸µìœ¼ë¡œ ì˜¬ë¼ê°‘ë‹ˆë‹¤.</span>
        </div>
    </div>

    <script>
        const rewards = [10, 30, 50, 80, 120, 150, 200, 250, 300, 500];
        const questions = [
            "ì¹œêµ¬ë‘ ì•½ì†í–ˆëŠ”ë° ê¹œë¹¡í•˜ê³  ëŠ¦ì  ì¤ë‹¤. ëˆ„êµ¬ íƒ“?",
            "ê³µë™ í”„ë¡œì íŠ¸ ë§ì³¤ëŠ”ë° ë‚´ê°€ ë§¡ì€ ë¶€ë¶„ì€ ì™„ë²½í–ˆë‹¤. ëˆ„êµ¬ íƒ“?",
            "ì—°ì¸ê³¼ ì‹¸ì› ëŠ”ë° ì›ì¸ ì œê³µì€ ë‚´ê°€ í–ˆì§€ë§Œ ìƒëŒ€ê°€ ë¨¼ì € í™”ëƒˆë‹¤. ëˆ„êµ¬ íƒ“?",
            "ê¸¸ ê°€ë‹¤ ë¶€ë”ªí˜”ëŠ”ë° ìƒëŒ€ë°©ì´ í•¸ë“œí° ë³´ë©° ê±¸ì–´ì˜¤ê³  ìˆì—ˆë‹¤. ëˆ„êµ¬ íƒ“?",
            "ë‚´ê°€ ì¶”ì²œí•œ ë§›ì§‘ì— ê°”ëŠ”ë° ìŒì‹ì´ ë„ˆë¬´ ë§›ì—†ì–´ì„œ ë¶„ìœ„ê¸°ê°€ ì‹¸í•´ì¡Œë‹¤. ëˆ„êµ¬ íƒ“?",
            "ìˆ ìë¦¬ì—ì„œ ë‚´ê°€ ìœë‹¤ê³  í–ˆëŠ”ë° ì§€ê°‘ì„ ë‘ê³  ì™”ë‹¤. ëˆ„êµ¬ íƒ“?",
            "ë¹Œë ¤ì¤€ ëˆ ê°šìœ¼ë¼ê³  í–ˆëŠ”ë° ìƒëŒ€ê°€ ì˜¤íˆë ¤ ì ë°˜í•˜ì¥ì´ë‹¤. ëˆ„êµ¬ íƒ“?",
            "ì¤‘ìš”í•œ ì‹œí—˜ ë‚  ì•ŒëŒì´ ì•ˆ ìš¸ë ¤ì„œ ì§€ê°í–ˆë‹¤. ëˆ„êµ¬ íƒ“?",
            "ì¡°ë³„ê³¼ì œ ë¬´ì„ìŠ¹ì°¨ìê°€ ìˆëŠ”ë° ì¡°ì¥ì´ ê´€ë¦¬ë¥¼ ëª» í–ˆë‹¤. ëˆ„êµ¬ íƒ“?",
            "ë‚´íƒ“ë„¤íƒ“ ì•±ì´ ë„ˆë¬´ ì¬ë°Œì–´ì„œ ë°¤ì„ ìƒˆë²„ë ¸ë‹¤. ëˆ„êµ¬ íƒ“?"
        ];

        let gameState = JSON.parse(localStorage.getItem('towerState')) || {
            currentFloor: 1, isEliminated: false, lastVotedRound: -1, selectedSide: null
        };

        let testResult = { my: 50, your: 50 };

        function updateGame() {
            const now = new Date();
            const sec = now.getSeconds();
            const currentRound = Math.floor(now.getTime() / 20000); 
            const phaseSec = sec % 20; 

            if (gameState.lastCheckedRound !== currentRound) {
                processRoundTransition(currentRound);
                gameState.lastCheckedRound = currentRound;
                saveState();
            }

            const displayRound = Math.floor(now.getMinutes() * 3 + sec / 20) % 10;
            const isVotePhase = phaseSec < 15; 

            document.getElementById('currentFloor').innerText = `${gameState.currentFloor}ì¸µ`;
            document.getElementById('debateQuestion').innerText = questions[displayRound];
            document.getElementById('rewardCoin').innerText = `${rewards[gameState.currentFloor-1]}ê°œ`;

            if (isVotePhase) {
                document.getElementById('roundTimer').innerText = `íˆ¬í‘œ ì¢…ë£Œê¹Œì§€ ${15 - phaseSec}ì´ˆ`;
                document.getElementById('resultBox').style.display = 'none';
                if(phaseSec === 14) {
                    const myRate = Math.floor(Math.random() * 70) + 15;
                    testResult = { my: myRate, your: 100 - myRate };
                }
                refreshButtons(true, currentRound);
            } else {
                document.getElementById('roundTimer').innerText = `ê²°ê³¼ í™•ì¸ ì¤‘... (${20 - phaseSec}ì´ˆ)`;
                showGaugeResult();
                refreshButtons(false, currentRound);
            }

            refreshBadge();
            updateCoinDisplay();
        }

        function showGaugeResult() {
            document.getElementById('resultBox').style.display = 'block';
            document.getElementById('barMy').style.width = testResult.my + '%';
            document.getElementById('barYour').style.width = testResult.your + '%';
            document.getElementById('textMy').innerText = `ë‚´ íƒ“ ${testResult.my}%`;
            document.getElementById('textYour').innerText = `ë„¤ íƒ“ ${testResult.your}%`;
            const winText = testResult.my > testResult.your ? "[ë‚´ íƒ“] ë‹¤ìˆ˜ê²° ìŠ¹ë¦¬!" : "[ë„¤ íƒ“] ë‹¤ìˆ˜ê²° ìŠ¹ë¦¬!";
            document.getElementById('winTag').innerText = winText;
        }

        function processRoundTransition(currentRound) {
            if (!gameState.isEliminated) {
                if (gameState.lastVotedRound < currentRound - 1) {
                    gameState.isEliminated = true;
                } else {
                    addCoin(rewards[gameState.currentFloor - 1]);
                    gameState.currentFloor = (gameState.currentFloor >= 10) ? 1 : gameState.currentFloor + 1;
                }
                gameState.selectedSide = null;
            }
        }

        function castVote(side) {
            const currentRound = Math.floor(new Date().getTime() / 20000);
            if (gameState.isEliminated) return;
            gameState.lastVotedRound = currentRound;
            gameState.selectedSide = side;
            saveState();
            refreshButtons(true, currentRound);
        }

        function refreshButtons(isVotePhase, currentRound) {
            const btnMy = document.getElementById('btnMy');
            const btnYour = document.getElementById('btnYour');
            const alreadyVoted = gameState.lastVotedRound === currentRound;

            btnMy.disabled = gameState.isEliminated || !isVotePhase || alreadyVoted;
            btnYour.disabled = gameState.isEliminated || !isVotePhase || alreadyVoted;
            btnMy.classList.toggle('selected', gameState.selectedSide === 'my');
            btnYour.classList.toggle('selected', gameState.selectedSide === 'your');
        }

        function refreshBadge() {
            const badge = document.getElementById('statusBadge');
            const reviveBtn = document.getElementById('reviveBtn');
            if (gameState.isEliminated) {
                badge.innerText = "íƒˆë½ (ê´€ì „ ì¤‘)";
                badge.className = "eliminated-badge";
                reviveBtn.style.display = "block";
            } else {
                badge.innerText = "ìƒì¡´ ì¤‘";
                badge.className = "survival-badge";
                reviveBtn.style.display = "none";
            }
        }

        function revive() {
            let userData = JSON.parse(localStorage.getItem('userData')) || {coin: 0};
            if (userData.coin < 100) { alert("ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤."); return; }
            userData.coin -= 100;
            gameState.isEliminated = false;
            
            // í•µì‹¬: ë¶€í™œ ì¦‰ì‹œ í˜„ì¬ ë¼ìš´ë“œ íˆ¬í‘œë¥¼ ê°€ëŠ¥í•˜ê²Œ ì´ˆê¸°í™”
            gameState.lastVotedRound = -1; 
            
            localStorage.setItem('userData', JSON.stringify(userData));
            saveState();

            // ë¶€í™œ ì¦‰ì‹œ ë²„íŠ¼ ìƒíƒœ ê°±ì‹ 
            const currentRound = Math.floor(new Date().getTime() / 20000);
            refreshButtons(true, currentRound);
            
            alert("ë¶€í™œ ì„±ê³µ! ì¦‰ì‹œ íˆ¬í‘œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        }

        function addCoin(amount) {
            let userData = JSON.parse(localStorage.getItem('userData')) || {coin: 0};
            userData.coin = (userData.coin || 0) + amount;
            localStorage.setItem('userData', JSON.stringify(userData));
        }

        function updateCoinDisplay() {
            const userData = JSON.parse(localStorage.getItem('userData')) || {coin: 0};
            document.getElementById('userCoinDisplay').innerText = `ğŸŸ¡ ${userData.coin.toLocaleString()}`;
        }

        function saveState() { localStorage.setItem('towerState', JSON.stringify(gameState)); }

        setInterval(updateGame, 1000);
        updateGame();
    </script>
</body>
</html>